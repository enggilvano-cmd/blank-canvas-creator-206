# Script para reparar histórico de migrations do Supabase
Write-Host "Reparando migrations..." -ForegroundColor Yellow

# Marcar migrations antigas como revertidas
$revertedMigrations = @(
    "20250820014401", "20250820014430", "20250820030437", "20250820050026",
    "20250820071701", "20250820071753", "20250820073644", "20250820074414",
    "20250820080825", "20250820080910", "20250822102631", "20250822103719",
    "20250822103922", "20251112040630", "20251112062115", "20251113002657",
    "20251113002849", "20251113004135", "20251113005405", "20251113005431",
    "20251113005502", "20251113173259", "20251115175632", "20251118024642",
    "20251118025719", "20251118025940", "20251118030028", "20251118042122",
    "20251118043601", "20251118043648", "20251118045056", "20251118050224",
    "20251118050830", "20251121160502", "20251121165949", "20251121180531",
    "20251121182848", "20251121184349", "20251121192620", "20251121194651",
    "20251122023143", "20251122024326", "20251122034511", "20251122202243",
    "20251122222057", "20251122222606", "20251123015006", "20251123015922",
    "20251123033206", "20251123033620", "20251123180615", "20251123205850",
    "20251123225601", "20251123231638", "20251123231852", "20251123232516",
    "20251124004444", "20251124025401", "20251124030402", "20251124031357",
    "20251124032558", "20251124032831", "20251124143309", "20251124155214",
    "20251124161424", "20251124164304", "20251124164514", "20251124165424",
    "20251124191657", "20251125194739", "20251125195304", "20251125200622",
    "20251125203108", "20251125210351", "20251125210802", "20251126005959",
    "20251126024602", "20251126033528", "20251126033803", "20251126034232",
    "20251126034610", "20251126035237", "20251126191151"
)

foreach ($migration in $revertedMigrations) {
    Write-Host "Repairing $migration as reverted..." -ForegroundColor Gray
    npx supabase migration repair --status reverted $migration
}

Write-Host "`nReparação concluída! Agora executando db push..." -ForegroundColor Green
npx supabase db push --linked
